<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UFC 도서관 공간대여</title>
  <link rel="stylesheet" href="/css/common/header.css">
  <!-- 도서관 전용 헤더 스타일로만 사용하기!! -->
  <link rel="stylesheet" href="/css/libMain.css">
  <link rel="stylesheet" href="/css/lib/space.css">
</head>

<body>

  <!-- 공용 헤더 -->
  <header th:replace="~{common/header}"></header>

  <!-- 도서관 전용 헤더 -->
  <th:block th:replace="~{common/lib/libNavVar}"></th:block>




  <!-- 세션의 회원 정보 얻어오기 -->
  <div class="spaceManager">

    <h1>일반 회원이 공간을 대여하는 페이지</h1>

    <!-- 출입구 표시 -->
    <div id="exitSack">
      <div class="exit">출입구</div>
      <div class="exit">출입구</div>
    </div>

    <!-- 생성된 div가 표시되는 부분 -->
    <div id="drawingArea"></div>

    <!-- 생성된 div 크기 조정 -->


  </div>



  <!-- 방의 상태 창 -->
  <div id="conditionGuide">

    <div class="boxSack ">
      <div class="conditionBox avail"></div>
      <p>: 이용 가능 / </p>
    </div>

    <div class="boxSack ">
      <div class="conditionBox nowUsing"></div>
      <p>: 현재 사용 중 /</p>
    </div>

    <div class="boxSack">
      <div class="conditionBox disavail"></div>
      <p>: 점검 중. 이용 불가</p>
    </div>

  </div>

  <!-- 필요한 정보 일반 -->
  <!-- 다음과 같은 정보가 필요 할 것.
    1. 로그인한 회원의 번호 표시
    2. 선택한 방의 번호
    3. 현재 이용 중인 공간의 번호
      - 이용 중인 공간이 있으면 공간 이용 불가
    4. 현재 이용 중인 열람실의 번호
      - 이용 중인 열람실이 있으면 공간 이용 불가
      confirm. 현재 이용 중인 열람실이 있습니다. 열람실 이용을 해제할까요?
        - yes 선택 : alert. 열람실 이용 해제, 공간 이용 등록 성공
        - no 선택 : alert. 열람실 이용을 계속합니다. 공간 이용 등록 취소.
  -->

  <!-- 필요한 정보 표시 -->
  <div>

    <!-- 1. 로그인한 회원의 번호 -->
    <div>
      회원님의 회원 번호 : <span th:text="${session.loginMember.memberNo}"></span>
    </div>

    <br>

    <div>
      <span>현재 선택한 공간 번호 : <span class="currentSelectSpace"></span> </span> <br>
    </div>

    <!-- 이용 중인 열람실 좌석이 없을 경우 -->
    <div th:if="${session.memberAndSeatSession == null}">
      <p>이용 중인 열람실 : 없음</p>
    </div>

    <!-- 이용중인 열람실 좌석이 있을 경우에만 표시 -->
    <div th:if="${session.memberAndSeatSession != null}">
      <th:block
        th:with="memberNo=${session.loginMember.memberNo}, seatNo=${session.memberAndSeatSession[session.loginMember.memberNo]}">
        <p>회원님이 사용 중인 열람실 좌석 번호:
          <span th:text="${seatNo}"></span>
        </p>
      </th:block>
    </div>

    <!-- 디버깅을 위한 값 출력 -->
    <!-- <p th:text="'loginMember: ' + ${session.loginMember}"></p> -->

    <!-- <p th:text="'memberAndSpaceSession: ' + ${session.memberAndSpaceSession}" display="none"  ></p> -->
    <!-- <p th:text="'이용 중인 공간 번호 : ' + ${session.memberAndSpaceSession[session.loginMember.memberNo]}"></p> -->

    <!-- 이용 중인 공간이 없을 경우 -->
    <!-- 해당 세션의 생성 주기로 인해 프로젝트 실행 시 오류 발생함... 나중에 고민해보자.. -->
    <!-- <th:block th:if="${session.memberAndSpaceSession[session.loginMember?.memberNo] == null}">
      <p> 회원님이 사용 중인 대여공간 :
        <span> 없음 </span>
      </p>
    </th:block> -->

    <!-- 이용 중인 공간이 있을 경우 -->
    <!-- <th:block th:if="${session.memberAndSpaceSession[session.loginMember.memberNo] != null}">
        <span th:text=" '이용 중인 공간 번호 : ' + ${session.memberAndSpaceSession[session.loginMember.memberNo]}"></span>
    </th:block> -->


    <div id="buttonSack">
      <form id="actionForm" action="/lib/space/wannaUseSpace" method="post">
        <input type="hidden" name="spaceNo" id="actionInput">
        <button type="button" onclick="wannaUseSpace()">이용하기</button>
        <button type="button" onclick="stopUsingSpace()">그만 사용하기</button>
        <button type="button" onclick="extendSpace()">공간 연장하기</button>
        <button type="button" onclick="bookingSpace()">공간 예약하기</button>

      </form>
    </div>

    <!-- 모달에서 이용할 사용자 정보 -->
    <div id="userInfo" data-user-no="${session.loginMember.getMemberNo()}"></div>


    <!-- 공간 예약하기 모달 -->
    <div id="bookingModal" class="modal">
      <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <div>선택한 공간 번호 : <span class="currentSelectSpace"></span></div>
          <div>해당 좌석의 이용 종료 시간 : <span id="seatEndTime"></span></div>
          <div>현재 시간 : <span id="currentTime"></span></div>
          <div class="time-picker">
              <label>사용 시작하고 싶은 시간:</label>
              <select id="amPm">
                  <option value="AM">AM</option>
                  <option value="PM">PM</option>
              </select>
              <select id="hour">
                  <option value="12">12</option>
                  <option value="01">01</option>
                  <option value="02">02</option>
                  <option value="03">03</option>
                  <option value="04">04</option>
                  <option value="05">05</option>
                  <option value="06">06</option>
                  <option value="07">07</option>
                  <option value="08">08</option>
                  <option value="09">09</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
              </select>
              <span>:</span>
              <select id="minute">
                  <option value="00">00</option>
                  <option value="05">05</option>
                  <option value="10">10</option>
                  <option value="15">15</option>
                  <option value="20">20</option>
                  <option value="25">25</option>
                  <option value="30">30</option>
                  <option value="35">35</option>
                  <option value="40">40</option>
                  <option value="45">45</option>
                  <option value="50">50</option>
                  <option value="55">55</option>
              </select>
          </div>
          <button onclick="realBookingSpace()">예약하기</button>
      </div>
  </div>
    </div>

</body>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    /* 메시지가 있는 경우 alert로 출력 */
    const message = /*[[${message}]]*/ '';
    if (message) {
      alert(message);
    }
  });
</script>

<script src="/js/lib/spaceUsing.js"></script>




</html>