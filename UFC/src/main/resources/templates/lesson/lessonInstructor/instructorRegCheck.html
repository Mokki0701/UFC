<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>강사 신청 확인</title>
  <style>
    .member-table {
      width: 100%;
      border-collapse: collapse;
    }

    .member-table,
    .member-table th,
    .member-table td {
      border: 1px solid black;
    }

    .member-table th,
    .member-table td {
      padding: 10px;
      text-align: left;
    }

    .member-table th {
      background-color: #f2f2f2;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 5px;
    }

    .action-buttons button {
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <!-- lessonCommon 들어가는 곳 시작 -->
  <th:block th:replace="~{lesson/lessonCommon/lessonCommon}"></th:block>
  <!-- lessonCommon 들어가는 곳 끝 -->


  <!-- 세미 헤더 들어가는 곳 시작 -->
  <th:block th:replace="~{lesson/lessonCommon/semiHeader}"></th:block>
  <!-- 세미 헤더 들어가는 곳 끝 -->

  <h1>강사 신청자들</h1>
  <table class="member-table" id="memberTable">
    <thead>
      <tr>
        <th>회원 번호</th>
        <th>이메일</th>
        <th>성함</th>
        <th>핸드폰 번호</th>
        <th>성별</th>
        <th>강의 분야</th>
        <th>소개</th>
        <th>정보 PDF</th>
        <th>이력서 PDF</th>
        <th>처리</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="member : ${members}">
        <td th:text="${member.memberNo}" class="member-no"></td>
        <td th:text="${member.memberEmail}" class="member-email"></td>
        <td th:text="${member.memberLastName} + ' ' + ${member.memberFirstName}" class="member-name"></td>
        <td th:text="${member.memberPhone}" class="member-phone"></td>
        <td th:text="${member.memberGender}" class="member-gender"></td>
        <td th:text="${member.instCategory}" class="member-category"></td>
        <td th:text="${member.instIntro}" class="member-intro"></td>

        <td class="member-intro">

          <a th:href="|@{/lesson/download/{instInfo} 
           (instInfo=${member.instInfo})}|" th:text="${member.instInfo}" download></a>
        </td>


        <td class="member-intro">


          <a th:href="|@{/lesson/download/{lastName}{firstName}이력서_{instResume} 
           (lastName=${member.memberLastName}, firstName=${member.memberFirstName}, instResume=${member.instResume})}|"
            th:text="${member.instResume}" download></a>


        </td>

        <td class="member-action">
          <div class="action-buttons">
            <button type="button" class="accept-btn" th:onclick="'accept(' + ${member.memberNo} + ', this)'">승낙</button>
            <button type="button" class="reject-btn" th:onclick="'reject(' + ${member.memberNo} + ', this)'">거절</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <script>

    // 승낙/거절 버튼 클릭 시
    function accept(memberNo, button) {
      fetch('/lesson/inst/accept', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(memberNo)
      })
        .then(response => {
          if (response.ok) {
            alert(memberNo + "번 회원의 요청이 승낙되었습니다.");
            const row = button.closest('tr');
            row.remove();
          } else {
            alert('승낙 요청에 실패했습니다.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('승낙 요청 중 오류가 발생했습니다.');
        });
    }

    function reject(memberNo, button) {
      fetch('/lesson/inst/reject', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ memberNo: memberNo })
      })
        .then(response => {
          if (response.ok) {
            alert(memberNo + "번 회원의 요청이 거절되었습니다.");
            const row = button.closest('tr');
            row.remove();
          } else {
            alert('거절 요청에 실패했습니다.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('거절 요청 중 오류가 발생했습니다.');
        });
    }
    // 승낙/거절 버튼 클릭 시 끝
  </script>
</body>

</html>